{% extends 'base.html' %}

{% block title %}Project · {{ project.title }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-start gap-3 mb-3">
  <div>
    <h1 class="h3 mb-1">{{ project.title }}</h1>
    <div class="text-muted">Created {{ project.created_at }}</div>
  </div>
  <div>
    <a class="btn btn-outline-secondary" href="/">Back</a>
  </div>
</div>

<div class="card mb-4">
  <div class="card-body">
    <h2 class="h5">Intent</h2>
    <p class="mb-0" style="white-space: pre-wrap">{{ project.intent_text }}</p>
  </div>
</div>

<div class="row g-4" data-project-id="{{ project.id }}" id="project-root">
  <div class="col-12 col-lg-6">
    <h2 class="h5 mb-2">Upload media</h2>

    <form
      id="project-upload-dropzone"
      class="dropzone border rounded bg-white"
      action="/api/projects/{{ project.id }}/upload"
      method="post"
      enctype="multipart/form-data"
    >
      <div class="dz-message">
        <strong>Drag &amp; drop</strong> images/videos here<br />
        <small class="text-muted">or click to choose files</small>
      </div>
    </form>

    <div class="mt-4">
      <div class="d-flex justify-content-between align-items-center">
        <h3 class="h6 mb-2">Media</h3>
        <div class="btn-group btn-group-sm" role="group">
          <button type="button" class="btn btn-outline-secondary" id="select-all">Select all</button>
          <button type="button" class="btn btn-outline-secondary" id="select-none">Select none</button>
        </div>
      </div>

      <div class="table-responsive">
        <table class="table table-sm align-middle" id="project-media-table">
          <thead>
            <tr>
              <th style="width: 2.5rem"></th>
              <th>Name</th>
              <th>Type</th>
              <th class="text-end">Size</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="5" class="text-muted">Loading…</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-6">
    <h2 class="h5 mb-2">Generate plans</h2>

    <div class="mb-3">
      <label for="project-intent" class="form-label">Intent override (optional)</label>
      <textarea
        id="project-intent"
        class="form-control"
        rows="6"
        placeholder="Leave blank to use the project intent"
      ></textarea>
      <div class="form-text">If blank, generation uses the project intent above.</div>
    </div>

    <div class="row g-2 align-items-end">
      <div class="col-12 col-md-6">
        <label for="ai-model" class="form-label">AI Model</label>
        <select id="ai-model" class="form-select">
          <!-- Hardcoded options for now; backend accepts `model` in generate JSON. -->
          <option value="gpt-4.1-mini">gpt-4.1-mini</option>
          <option value="gpt-4.1">gpt-4.1</option>
          <!-- Default matches backend fallback in app/ai/client.py (OPENAI_MODEL default). -->
          <option value="gpt-4o-mini" selected>gpt-4o-mini</option>
        </select>
      </div>

      <div class="col-12 col-md-6">
        <button id="project-generate-btn" class="btn btn-primary w-100" type="button">
          Generate using selected media
        </button>
      </div>
    </div>

    <div id="project-generate-status" class="mt-3"></div>

    <div class="mt-4">
      <h3 class="h6">Result</h3>
      <pre class="result-box" id="project-result">(not generated yet)</pre>
    </div>

    <div class="mt-4">
      <h3 class="h6">Previous Plans</h3>
      <div class="list-group" id="plans-list">
        <div class="list-group-item text-muted">Loading…</div>
      </div>

      <div class="mt-3">
        <h4 class="h6">Selected plan</h4>
        <pre class="result-box" id="plan-detail">(select a plan)</pre>
      </div>
    </div>
  </div>
</div>
{% endblock %}
